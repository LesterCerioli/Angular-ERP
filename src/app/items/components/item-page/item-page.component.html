<app-base-page
  [saveButtonDisabled]="vm.form?.invalid"
  (save)="vm.save()">
  <span title>{{ 'items.item-page' | translate }}</span>
  <span sub-title>{{ vm.subTitle$ | async }}</span>
  <form [formGroup]="vm.form">
    <mat-grid-list [cols]="vm.isMobile ? 1 : 4" rowHeight="64px">

      <mat-grid-tile>
        <mat-form-field>
          <input matInput [placeholder]="'items.caption.name' | translate" formControlName="name" />
        </mat-form-field>
      </mat-grid-tile>

      <mat-grid-tile>
        <mat-form-field>
          <input matInput [placeholder]="'items.caption.code' | translate" formControlName="code" />
        </mat-form-field>
      </mat-grid-tile>

      <mat-grid-tile>
        <mat-form-field>
          <input matInput [placeholder]="'items.caption.bar-code' | translate" formControlName="barCode" />
        </mat-form-field>
      </mat-grid-tile>

      <mat-grid-tile>
        <mat-form-field>
          <mat-label>{{ 'items.caption.type' | translate }}</mat-label>
          <mat-select formControlName="type">
            <mat-option *ngFor="let type of vm.itemTypes" [value]="type.value">
              {{type.name | translate}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </mat-grid-tile>
      
      <mat-grid-tile>
        <mat-form-field>
          <input matInput [placeholder]="'items.caption.price' | translate" formControlName="price" type="number" />
        </mat-form-field>
      </mat-grid-tile>

      <mat-grid-tile>
        <mat-form-field>
          <input matInput [placeholder]="'items.caption.contractor' | translate" formControlName="contractor" />
          <button mat-button matSuffix mat-icon-button *ngIf="vm.form?.get('contractor').value"
            (click)="vm.form.get('contractor').setValue(null)">
            <mat-icon>clear</mat-icon>
          </button>
          <button mat-button matSuffix mat-icon-button (click)="vm.openLookup('Customer', 'contractor', vm.contractorDisplayColumns)">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </mat-grid-tile>
  
      <mat-grid-tile [colspan]="vm.isMobile ? 1 : 2">
        <mat-form-field style="width: 100%; padding: 3px 0 3px 0">
          <input matInput [placeholder]="'items.caption.description' | translate" formControlName="description" />
        </mat-form-field>
      </mat-grid-tile>
      

    </mat-grid-list>

    <mat-accordion>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ vm.getEntitySchemaPropertyByName('features').caption | translate }}
          </mat-panel-title>
          <mat-panel-description>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-action-row>
          <div style="width: 100%; display: flex; justify-content: flex-end">
            <button mat-button color="primary" (click)="vm.addFeature()">{{ 'common.add-button' | translate }}</button>
          </div>
         </mat-action-row>
        <mat-action-row *ngFor="let control of vm.featureControlList; let i = index" [formGroup]="vm.featureControlList[i]">
          <mat-form-field>
            <input matInput [placeholder]="'item-features.caption.name' | translate" formControlName="name" />
          </mat-form-field>
          <mat-form-field>
            <input matInput [placeholder]="'item-features.caption.value' | translate" formControlName="value" />
          </mat-form-field>
        </mat-action-row>
      </mat-expansion-panel>
    </mat-accordion>
  </form>
</app-base-page>